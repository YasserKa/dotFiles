#!/bin/sh

APP_NAME="switch-sink"

# Get the index of the SINK by getting the 4th line before of the line that has
# <STATE> (e.g. RUNNING, IDLE, SUSPENDED) and extract the integer

CURR_SINK=$(pacmd list-sinks | sed -n $(($(pacmd list-sinks | grep -n RUNNING | cut -d : -f 1)-4))p | grep -Eo [0-9])

NEW_SINK=$(pacmd list-sinks | sed -n $(($(pacmd list-sinks | grep -nE "state: (IDLE|SUSPENDED)" | cut -d : -f 1)-4))p | grep -Eo [0-9])

message=""
icon=""
# HACK: current sink is 2 (which is 1), switch to sink 0
if [[ $CURR_SINK -eq 1 ]]; then
    message="Switching to displaylink sink"
    icon="earbud-sound-64"
else
    message="Switching to built-in sink"
    icon="laptop-sound-64"
fi

dunstify --appname $APP_NAME --timeout=1000 --icon="$icon" "$message"

pacmd set-default-sink $NEW_SINK
