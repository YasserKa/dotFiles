#!/usr/bin/env bash

xdotool keyup Super_L

# Class name for the ambient music tab
AMBIENT_CLASS_NAME="ambient_music"
string_length=$(xclip -selection clipboard -o | wc -m)

if [[ $string_length -gt 30 ]]; then
    notify-send "String is too long"
    exit
fi

function get_id_not_ambient () {
    pids=$(xdotool search --class qutebrowser)

    QUTEBROWSER_ID=""

    for pid in $pids; do
        class_name=$(xdotool getwindowclassname $pid)
        if [[ $class_name != $AMBIENT_CLASS_NAME ]]; then
            QUTEBROWSER_ID=$pid
            break
        fi
    done

    echo $QUTEBROWSER_ID
}

QUTEBROWSER_ID=$(get_id_not_ambient)

if [[ -z $QUTEBROWSER_ID ]]; then
    qutebrowser &
fi

while [[ -z $(get_id_not_ambient) ]]; do
    sleep 0.1
done

pid=$(get_id_not_ambient)

xdotool windowactivate $pid
sleep 0.1
xdotool key 0xff1b
xdotool type O def
xdotool key space
xdotool type $(xclip -selection clipboard -o)
xdotool key enter
