#!/usr/bin/env bash
# This script is taken and editied from https://a3nm.net/git/mybin/file/my-pinentry.html
#
# choose pinentry depending on PINENTRY_USER_DATA
# requires pinentry-curses and pinentry-gtk2
# this *only works* with gpg 2
# see https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=802020

case "$PINENTRY_USER_DATA" in
	gtk) exec /usr/bin/pinentry-gtk "$@" ;;
	gnome)
		source "$HOME/.bashrc.d/functions.bash"
		PATTERN="^Gcr-prompter$|^gcr-prompter$|^Pinentry-gtki$"
		# Redirecting stdout is needed for it to work
		{ wait_window "$PATTERN" && goto_window "$PATTERN"; } >/dev/null &
		disown
		exec /usr/bin/pinentry-gnome3 "$@"
		;;
	none) exit 1 ;;
	*) exec /usr/bin/pinentry-tty "$@" ;;
esac
