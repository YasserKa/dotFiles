#!/usr/bin/env bash
# Description: open mynoise website and press a key (pause, resume, increase/decrease volume)
# Dependencies: xdotool, firefox

URL="https://mynoise.net/NoiseMachines/medievalMinstrelSoundscapeGenerator.php?l=29292929292929292929"

# Class name for the application used by xdotool (used to have one instance open at all time)
CLASS="ambient_music"

function get_id_ambient () {
    firefox_id=""

    # Check if class name is available
    pid_class_name=$(xdotool search --class $CLASS)

    if [[ ! -z $pid_class_name ]]; then
        firefox_id=$pid_class_name
    else
        # Check for the dot "•" in the title of page
        pids_firefox=$(xdotool search --class firefox)
        for pid in $pids_firefox; do
            name=$(xdotool getwindowname $pid)
            if [[ $name == *"•"* ]]; then
                sleep 0.1
                firefox_id=$pid
                break
            fi
        done
    fi

    echo $firefox_id
}

# If window doesn't exist it, open it
if [[ -z $(get_id_ambient) ]];  then
    # Open and wait until the website loads
    firefox --new-window $URL &
    while [[ -z $(get_id_ambient) ]]; do
        sleep 0.1
    done

    # Assign class name
    xdotool set_window --class "$CLASS" $(get_id_ambient)
else
    xdotool key --window $(get_id_ambient) $1
fi
