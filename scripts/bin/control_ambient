#!/bin/sh

function get_id_ambient () {
    pids=$(xdotool search --class qutebrowser)

    QUTEBROWSER_ID=""

    for pid in $pids; do
        name=$(xdotool getwindowname $pid)
        if [[ $name == *"â€¢"* ]]; then
            QUTEBROWSER_ID=$pid
            break
        fi
    done

    echo $QUTEBROWSER_ID
}

# open a new window for mynoise if it doesn't exist and wait until its loaded
if [[ -z $(get_id_ambient) ]]; then
    qutebrowser --target window \
    "https://mynoise.net/NoiseMachines/dudukSoundGenerator.php?l=21212121212121211031&mt=1" &
    while [[ -z $(get_id_ambient) ]]; do
        sleep 0.1
    done
    sleep 2
fi

xdotool key --window $(get_id_ambient) $1
