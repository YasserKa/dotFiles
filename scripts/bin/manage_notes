#!/bin/env sh

case $1 in
    general )
        if [[ -z $(ps aux | grep -v "grep" | grep "notes/general.md") ]]; then
            (nohup alacritty --title general_notes -e nvim $HOME/notes/general.md >/dev/null 2>&1 &)
            sleep .7
            i3-msg '[title="general_notes"] scratchpad show'
        else
            i3-msg '[title="general_notes"] scratchpad show'
        fi
        ;;
    emacs )
        title="$1_notes"
        if [[ -z $(wmctrl -l | grep "$title") ]]; then
            emacs -l "$HOME/.emacs.d/lisp/org-refile-override.el" --title=$title -eval "
            (progn
           (add-hook 'org-capture-mode-hook 'delete-other-windows)
           (advice-add 'org-capture-refile :override 'org-capture-refile-override)

           (add-hook 'focus-in-hook #'(lambda  () (interactive) (if (not
           (bound-and-true-p org-capture-mode)) (org-capture nil \"d\"))))

            (add-hook 'org-capture-after-finalize-hook #'(lambda () (interactive)
            (start-process-shell-command \"\" nil \"i3-msg ' scratchpad show'\")
             (org-save-all-org-buffers)
             (if (bound-and-true-p org-capture-mode) (org-capture-kill))
             (kill-matching-buffers \"capture.org\" t t)

             ))

             )" &
             while [[ -z $(wmctrl -l | grep "$title") ]]; do
                 sleep 0.1
             done
             i3-msg "[title=$title] scratchpad show"
         else
             i3-msg "[title=$title] scratchpad show"
        fi
        ;;
esac
