# http://i3wm.org/docs/userguide.html
# Gaps <<<
for_window [class=".*"] border pixel 0

gaps inner 5
gaps outer 5
# >>>
# Workspaces <<<
set $mod Mod4

font pango:Inconsolata 11

# Change focus
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right
bindsym $mod+h focus left

# Move focused window
# There's a bug in i3 that doesn't focus the window after it moves to another
# screen, this script centers the mouse to the moved window mitigating the bug
bindsym $mod+Shift+j exec $XDG_CONFIG_HOME/i3/i3-center-cursor-on-window.sh move down
bindsym $mod+Shift+k exec $XDG_CONFIG_HOME/i3/i3-center-cursor-on-window.sh move up
bindsym $mod+Shift+l exec $XDG_CONFIG_HOME/i3/i3-center-cursor-on-window.sh move right
bindsym $mod+Shift+h exec $XDG_CONFIG_HOME/i3/i3-center-cursor-on-window.sh move left


# Split in horizontal orientation
bindsym $mod+Shift+v split h

# Split in vertical orientation
bindsym $mod+v split v

# Enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# Toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# Worspaces
set $browser 1
set $coding 2
set $notes 3
set $git 4
set $video 5
set $wp6 6
set $social 7
set $documents 8
set $wp9 9
set $wp0 0

# Workspaces on specific screens
set $monitor_primary eDP-1
set $monitor_left DVI-I-2-2
set $monitor_right DVI-I-1-1

workspace $browser output $monitor_primary
workspace $coding output $monitor_primary
workspace $notes output $monitor_primary
workspace $video output $monitor_primary
workspace $documents output $monitor_primary

workspace $git output $monitor_right

workspace $wp6 output $monitor_left
workspace $wp9 output $monitor_left
workspace $social output $monitor_left

# Bindsym using mod+# to workspace #
bindsym $mod+1 workspace $browser
bindsym $mod+2 workspace $coding
bindsym $mod+3 workspace $notes
bindsym $mod+4 workspace $git
bindsym $mod+5 workspace $video
bindsym $mod+6 workspace $wp6
bindsym $mod+7 workspace $social
bindsym $mod+8 workspace $documents
bindsym $mod+9 workspace $wp9
bindsym $mod+0 workspace $wp0


# Move focused container to workspace
bindsym $mod+Shift+1 move container to workspace $browser
bindsym $mod+Shift+2 move container to workspace $coding
bindsym $mod+Shift+3 move container to workspace $notes
bindsym $mod+Shift+4 move container to workspace $git
bindsym $mod+Shift+5 move container to workspace $video
bindsym $mod+Shift+6 move container to workspace $wp6
bindsym $mod+Shift+7 move container to workspace $social
bindsym $mod+Shift+8 move container to workspace $documents
bindsym $mod+Shift+9 move container to workspace $wp9
bindsym $mod+Shift+0 move container to workspace $wp0
bindsym $mod+Shift+z move container to workspace back_and_forth

# Go back and forth
workspace_auto_back_and_forth yes
bindsym $mod+z workspace back_and_forth

# Opening softwares to a default workspaces
# Use xprop to get the class
assign [class="Zathura"] workspace $documents
assign [class="mpv"] workspace $video
assign [class="Slack"] workspace $social
assign [class="Chromium"] workspace $wp9

# For notify-me script
for_window [instance="notify_me_profile"] move scratchpad
for_window [instance="facebook_bot_profile"] move scratchpad

# Firefox ambience page
for_window [class="ambient_music"] move scratchpad
for_window [class="firefox"] move scratchpad

# Making softwares in floating mode
for_window [class="Vlc|feh|Shutter"] floating enable

# Enable floating for windows that has floating class
# for_window [class="floating"] floating enable
for_window [instance="floating"] floating enable
assign [instance="floating"] output primary

# Change workspace when window is activated (used for qutebrower gt)
include ./focus_on_window_activation_config
# >>>
# Modes <<<

# Resize window
bindsym $mod+r mode "resize"
mode "resize" {

# These bindings trigger as soon as you enter the resize mode
    bindsym h resize shrink width 10 px or 10 ppt
        bindsym j resize grow height 10 px or 10 ppt
        bindsym k resize shrink height 10 px or 10 ppt
        bindsym l resize grow width 10 px or 10 ppt

        bindsym Control+bracketleft mode "default"
        bindsym Escape mode "default"
}

# Emacs org clock
bindsym $mod+q mode "clock"
mode "clock" {
        bindsym i exec $XDG_CONFIG_HOME/polybar/org_clock clock_in; mode "default"
        bindsym o exec $XDG_CONFIG_HOME/polybar/org_clock clock_out; mode "default"
        bindsym c exec $XDG_CONFIG_HOME/polybar/org_clock clock_cancel; mode "default"
        bindsym t exec $XDG_CONFIG_HOME/polybar/org_clock clock_toggle; mode "default"
        bindsym t exec $XDG_CONFIG_HOME/polybar/org_clock go_to_item; mode "default"

        bindsym Control+bracketleft mode "default"
        bindsym Escape mode "default"
}

# Music player
bindsym $mod+c mode "cmus"
mode "cmus" {
    bindsym i exec $XDG_CONFIG_HOME/cmus/cmus_notification
        bindsym s exec cmus-remote --pause
        bindsym n exec cmus-remote --next
        bindsym p exec cmus-remote --prev

        bindsym h exec cmus-remote --volume +2%
        bindsym l exec cmus-remote --volume -2%

        bindsym Control+bracketleft mode "default"
        bindsym Escape mode "default"
}

bindsym $mod+Shift+c mode "control_ambient"
mode "control_ambient" {
    bindsym s exec $HOME/bin/control_ambient p; mode "default"

        bindsym h exec $HOME/bin/control_ambient k
        bindsym l exec $HOME/bin/control_ambient j

        bindsym Control+bracketleft mode "default"
        bindsym Escape mode "default"
}

bindsym $mod+s mode "sharing"
mode "sharing" {
    bindsym i exec $HOME/bin/share -i; mode "default"
        bindsym c exec $HOME/bin/share -c; mode "default"
        bindsym v exec $HOME/bin/share -v; mode "default"
        bindsym t exec $HOME/bin/share -t; mode "default"
        bindsym n exec $HOME/bin/share -n; mode "default"

        bindsym Control+bracketleft mode "default"
        bindsym Escape mode "default"
}

# >>>
# Bindings <<<

# Password
bindsym $mod+p exec $XDG_CONFIG_HOME/rofi/bwmenu

# Tmux
bindsym $mod+t exec rofi -show tmux -modi tmux:$XDG_CONFIG_HOME/rofi/rofi-tmux

# Documents
bindsym $mod+Shift+d exec $XDG_CONFIG_HOME/rofi/rofi-documents

# Restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
bindsym $mod+Shift+w reload

# Scratchpad
bindsym $mod+Shift+minus move scratchpad
# Don't show general notes
bindsym $mod+minus [title="^(?!.*_notes).*$"] scratchpad show

# note taking
bindsym $mod+n exec --no-startup-id $HOME/bin/open_general_notes
bindsym $mod+e exec --no-startup-id $HOME/bin/create_note "org_protocol"
bindsym $mod+Shift+n exec --no-startup-id $HOME/bin/create_note "tex"

for_window [title="^tmp_"] resize set 800 400, move [absolute] position center
# Put general notes in scratchpad
for_window [title="general_notes"] move scratchpad, resize set 990 820, move [absolute] position center

# Temporary latex file
bindsym $mod+Return exec $TERMINAL
bindsym $mod+Shift+q kill
bindsym $mod+shift+x exec i3lock --color 000000

# Unmount all storage devices
bindsym $mod+shift+u exec --no-startup-id udiskie-umount -a

# Switch off light
bindsym $mod+o exec "sleep 0.5; exec xset dpms force off"

# Screen brightness controls
bindsym XF86MonBrightnessUp exec --no-startup-id xbacklight -inc 20
bindsym XF86MonBrightnessDown exec --no-startup-id xbacklight -dec 20

# Cmus
bindsym XF86AudioPlay exec cmus-remote --pause
bindsym XF86AudioNext exec cmus-remote --next
bindsym XF86AudioPrev exec cmus-remote --prev

# Mail
bindsym $mod+Shift+m exec --no-startup-id check_mail

# Rofi
bindsym $mod+d exec rofi -show run

bindsym $mod+a exec switch_audio_sink
bindsym $mod+x exec --no-startup-id search_dictionary
# >>>
# Sartup <<<

# Fetch email
exec $HOME/bin/wait_internet && check_mail

# Pick a random background image
exec_always --no-startup-id feh --bg-scale `find $HOME/Pictures/WallPapers/. -type f | shuf -n1`
# Composer for transparency
# exec_always --no-startup-id "killall picom; picom -f --config $XDG_CONFIG_HOME/picom.conf"
exec --no-startup-id "picom -f --config $XDG_CONFIG_HOME/picom.conf"

# Status bar
exec_always --no-startup-id $XDG_CONFIG_HOME/polybar/launch

exec --no-startup-id $HOME/bin/manage_notes emacs && i3-msg "[title=emacs_notes] move scratchpad"

# Notes
exec --no-startup-id i3-msg 'workspace 3; exec emacs --file=$HOME/notes/org/general.org; workspace 1; exec qutebrowser'
# >>>
