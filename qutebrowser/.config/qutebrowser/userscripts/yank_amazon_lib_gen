#!/usr/bin/env bash

LIB_LINK="https://libgen.li/index.php"
# sed expression generated by chatGPT
# This will include the first and last (if exists) authors only
AUTHORS="$(pup --file "$QUTE_HTML" ".author.notFaded text{}" | sed -e ':a;N;$!ba;s/\n\s*(.*),\s*/\ /g' -e 's/^\s*//g' -e 's/\s*(.*)//g' -e 's/\s*$//')"
AUTHORS="${AUTHORS%Format*}"

# Replace "&" with "and"
TITLE="$(pup --file "$QUTE_HTML" "#productTitle text{}" | sed -r "s/&amp;/and/g")"

LINK="$LIB_LINK?req=${TITLE:2}+${AUTHORS}&order=year&ordermode=desc&covers=on"

echo "open -w $LINK" >>"$QUTE_FIFO"
