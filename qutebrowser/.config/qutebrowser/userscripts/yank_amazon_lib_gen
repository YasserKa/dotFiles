#!/usr/bin/env bash

LIB_LINK="https://libgen.li/index.php"
# sed expression generated by chatGPT
AUTHORS="$(pup --file "$QUTE_HTML" ".author.notFaded text{}" | sed -e ':a;N;$!ba;s/\n\s*(Author),\s*/\ /g' -e 's/^\s*//g' -e 's/\s*(Author)//g' -e 's/\s*$//')"
AUTHORS="${AUTHORS%Format*}"

# Replace "&" with "and"
TITLE="$(pup --file "$QUTE_HTML" "#productTitle text{}" | sed -r "s/&amp;/and/g")"

LINK="$LIB_LINK?req=${TITLE:2}+${AUTHORS}&order=year&ordermode=desc&covers=on"

# dunstify "$TITLE"
echo "open -w $LINK" >>"$QUTE_FIFO"
