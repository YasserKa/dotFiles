#!/usr/bin/env bash

# Yank org link
# dependencies:
# remove_emoji script
# options:
# --clean: If it's a github repo root, get the package name only

title="$QUTE_TITLE"
url="$QUTE_URL"

# Assign it to the github repo name only
if [[ "$1" == "--clean" ]]; then
	url_root="$(echo "$QUTE_URL" | awk -F '/' '{print $3}')"

	# Should be at root of the repo
	# Checked by counting number of dashes
	num_dashes=$(echo "$QUTE_URL" | grep -o "/" | wc -l)

	if [[ "$url_root" == "github.com" && $num_dashes == 4 ]]; then
		title=$(echo "$QUTE_TITLE" | awk -F : '{ print $1}')
	fi
	url="${url%#*}"
fi

# Emojis are removed because org link-prettier shows the link twice for titles
# containing emojis
title_no_emoji="$("$HOME/bin/remove_emoji" "$title")"
echo -n "[[$url][$title_no_emoji]]" | xclip -selection c
echo "message-info 'url turned to org url'" >>"$QUTE_FIFO"
