#!/usr/bin/env bash

# Dependencies: poetry

# Install packages needed for using vim and jupyter notebook
# and create notebooks that sync both notebooks and python files


[[ ! "$1" && "$1" != "init" && "$1" != "create" ]] && \
    echo "Need an argument, 'init' or 'create <notebook>'" && exit

[[ "$1" == "create" && -z "$2" ]] && \
    echo "Need notebook name as an argument" && exit

if [[ "$1" == "init" ]]; then
    # Install jupytext and jupyter_ascending for syncing
    poetry add --group dev jupyter_nbextensions_configurator jupytext jupyter_ascending jupyter
    poetry shell

    jupyter nbextension install jupytext --py --user
    jupyter nbextension enable  jupytext  --py --user

    jupyter nbextension install jupyter_ascending --py --user
    jupyter nbextension enable  jupyter_ascending --py --user
    jupyter serverextension enable jupyter_ascending --py --user
else
    # Create file using jupyter ascending
    python -m jupyter_ascending.scripts.make_pair --base "$2"

    jupytext --set-formats ipynb,py:percent "$2.sync.ipynb"

    # open notebook
    jupyter notebook "$(pwd)/$2.sync.ipynb" &> /dev/null &
    nvim "$(pwd)/$2.sync.py"
fi
