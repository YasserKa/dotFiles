#!/usr/bin/env bash

# Install packages needed for using vim and jupyter notebook
# and create notebooks that sync both notebooks and python files


[[ -z "$1" && "$1" != "setup" && "$1" != "create_notebook" ]] && \
    echo "Need at least 'setup' or 'create_notebook' as argument" && exit

[[ "$1" == "create_notebook" && -z "$2" ]] && \
    echo "Need notebook name" && exit

if [[ "$1" == "setup" ]]; then
    # Install jupytext and jupyter_ascending for syncing
    pipenv install --dev jupyter_nbextensions_configurator jupytext jupyter_ascending jupyter
    pipenv shell

    jupyter nbextension install jupytext --py --user
    jupyter nbextension enable  jupytext  --py --user

    jupyter nbextension install jupyter_ascending --py --user
    jupyter nbextension enable  jupyter_ascending --py --user
    jupyter serverextension enable jupyter_ascending --py --user
else
    # Create file using jupyter ascending
    python -m jupyter_ascending.scripts.make_pair --base "$2"

    jupytext --set-formats ipynb,py:percent "$2.sync.ipynb"

    # open notebook
    jupyter notebook "$(pwd)/$2.sync.ipynb" &> /dev/null &
    nvim "$(pwd)/$2.sync.py"
fi
